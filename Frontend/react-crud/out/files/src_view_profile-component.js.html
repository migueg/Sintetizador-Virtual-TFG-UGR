<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\view\profile-component.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Analyser.html">Analyser</a></li>
                                <li><a href="../classes/Anlyser.html">Anlyser</a></li>
                                <li><a href="../classes/App.html">App</a></li>
                                <li><a href="../classes/Delay.html">Delay</a></li>
                                <li><a href="../classes/Distorsion.html">Distorsion</a></li>
                                <li><a href="../classes/Effect.html">Effect</a></li>
                                <li><a href="../classes/Envelope.html">Envelope</a></li>
                                <li><a href="../classes/Equalizer.html">Equalizer</a></li>
                                <li><a href="../classes/ErrorPage.html">ErrorPage</a></li>
                                <li><a href="../classes/Filter.html">Filter</a></li>
                                <li><a href="../classes/Header.html">Header</a></li>
                                <li><a href="../classes/Index.html">Index</a></li>
                                <li><a href="../classes/Library.html">Library</a></li>
                                <li><a href="../classes/LimitedKnob.html">LimitedKnob</a></li>
                                <li><a href="../classes/Loader.html">Loader</a></li>
                                <li><a href="../classes/Login.html">Login</a></li>
                                <li><a href="../classes/Midi.html">Midi</a></li>
                                <li><a href="../classes/Modal.html">Modal</a></li>
                                <li><a href="../classes/ModalDelete.html">ModalDelete</a></li>
                                <li><a href="../classes/ModalLoad.html">ModalLoad</a></li>
                                <li><a href="../classes/ModalPassword.html">ModalPassword</a></li>
                                <li><a href="../classes/ModalSave.html">ModalSave</a></li>
                                <li><a href="../classes/Navigator.html">Navigator</a></li>
                                <li><a href="../classes/Oscilador.html">Oscilador</a></li>
                                <li><a href="../classes/oscillator.html">oscillator</a></li>
                                <li><a href="../classes/Piano.html">Piano</a></li>
                                <li><a href="../classes/Profile.html">Profile</a></li>
                                <li><a href="../classes/Recorder.html">Recorder</a></li>
                                <li><a href="../classes/Reverb.html">Reverb</a></li>
                                <li><a href="../classes/Saver.html">Saver</a></li>
                                <li><a href="../classes/SignUp.html">SignUp</a></li>
                                <li><a href="../classes/Synth.html">Synth</a></li>
                                <li><a href="../classes/TableUI.html">TableUI</a></li>
                                <li><a href="../classes/Voice.html">Voice</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/App.html">App</a></li>
                                <li><a href="../modules/Delay.html">Delay</a></li>
                                <li><a href="../modules/Distorsion.html">Distorsion</a></li>
                                <li><a href="../modules/Filter.html">Filter</a></li>
                                <li><a href="../modules/filterTypes.html">filterTypes</a></li>
                                <li><a href="../modules/FX.html">FX</a></li>
                                <li><a href="../modules/Knob.html">Knob</a></li>
                                <li><a href="../modules/Navigator.html">Navigator</a></li>
                                <li><a href="../modules/OscComponents.html">OscComponents</a></li>
                                <li><a href="../modules/Piano.html">Piano</a></li>
                                <li><a href="../modules/Reverb.html">Reverb</a></li>
                                <li><a href="../modules/synth.html">synth</a></li>
                                <li><a href="../modules/types.html">types</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src\view\profile-component.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import React from &#x27;react&#x27;
import  {Container} from &#x27;react-bootstrap&#x27;;

import ModalPassword from &#x27;./elements/modals/modal-password&#x27;;

import portada from &#x27;../img/portada.jpg&#x27;;
import editar from &#x27;../img/editar.png&#x27;
import success from &#x27;../img/success.png&#x27;;
import failure from &#x27;../img/failure.png&#x27;;

import &#x27;../css/login.css&#x27;;
import &#x27;../css/loader.css&#x27;;
import &#x27;bootstrap/dist/css/bootstrap.css&#x27;;


import { sinte } from &#x27;./osc-components&#x27;;

/**
 * Proporciona un componente para el perfil de usuario
 * 
 * @class Profile
 * @constructor
 */
class Profile extends React.Component{
    #profile
    
    constructor(){
        super();
        this.state ={}
        this.#profile = {}
        this.edit = {}
        
    }

    /**
     * Se encarga de obtener el perfil del usuario y setearlo antes de que el componente
     * se renderice
     * 
     * @method componentDidMount
     */
    async componentDidMount(){
       var profile = await sinte.fetchProfile(&#x27;profile&#x27;)
       var maxSize = await sinte.fetchProfile(&#x27;maxSize&#x27;);
       
       console.log(maxSize)
       this.setState({maxSize: maxSize.msg})
       this.setState({userSpace: profile.profile.size})
       this.setState(profile.profile)
       
       console.log(this.state.maxSize)
       this.__paintProgressBar()

    }

    /**
     * Pinta la barra de espacio disponible
     * 
     * @method paintProgressBar
     * @private
     */
    __paintProgressBar(){
        var value =  Math.round(this.state.userSpace * 1000) / 1000;
        document.getElementById(&#x27;progress&#x27;).style.width = value + &#x27;%&#x27;
        document.getElementById(&#x27;space-available&#x27;).innerText = value + &#x27;% de &#x27; + this.state.maxSize + &#x27; MB&#x27;

    }

    /**
     * Se encarga de interpretar una respuesta de la fachada
     * 
     * @method handleResponse
     * @param {Object} response 
     * @private
     */
    __handleResponse(response){
        document.getElementById(&#x27;span-username&#x27;).style.display = &#x27;none&#x27;;
        document.getElementById(&#x27;span-email&#x27;).style.display = &#x27;none&#x27;;
        document.getElementById(&#x27;span-no-edit&#x27;).style.display = &#x27;none&#x27;;


        if(response.state){
            document.getElementById(&#x27;text-success&#x27;).innerText = response.msg;
            this.__hideLoader(&#x27;200&#x27;);
            setTimeout(function(){window.location.reload();},2000) //Se recarga la pagina despues de 2 segundos

        }else{
            if(response.code === 409){
                this.__hideLoader(&#x27;409&#x27;);

                if(response.msg.search(&#x27;usuario&#x27;) !== -1){ //Se encuentra la palabra usuario
                    var span = document.getElementById(&#x27;span-username&#x27;);
                    span.style.display = &#x27;&#x27;;
                    span.innerText = &#x27;*&#x27;+ response.msg;
                    
                }
                if(response.msg.search(&#x27;email&#x27;) !== -1){ //Se encuentra la palabra usuario
                    var span = document.getElementById(&#x27;span-email&#x27;);
                    span.style.display = &#x27;&#x27;;
                    span.innerText = &#x27;*&#x27;+ response.msg;
                }
            }else{
                document.getElementById(&#x27;text-failure&#x27;).innerText = response.msg;
                this.__hideLoader(&#x27;500&#x27;);
            }
        }
    }

    /**
     * Esconde el cargador
     * 
     * @method hideLoader
     * @param {Integer} code 
     * @private
     */
    __hideLoader(code){
        document.getElementById(&#x27;loader&#x27;).style.display = &#x27;none&#x27;;
        if(code === &#x27;409&#x27;){
            document.getElementById(&#x27;profile&#x27;).style.display = &#x27;flex&#x27;; 
        }
        if(code == &#x27;500&#x27;){
            document.getElementById(&#x27;failure&#x27;).style.display = &#x27;&#x27;;
        }
        if(code == &#x27;200&#x27;){
            document.getElementById(&#x27;success&#x27;).style.display = &#x27;&#x27;;
        }
    }
    /**
     * Enseña el cargador
     * 
     * @method showLoader
     * @private
     */
    __showLoader(){
        document.getElementById(&#x27;profile&#x27;).style.display = &#x27;none&#x27;;
        document.getElementById(&#x27;loader&#x27;).style.display = &#x27;&#x27;;
    }

    /**
     * Manda los mensajes para editar el perfil
     * 
     * @method confirmEdit
     * @async
     */
    async confirmEdit(){
        var username = document.getElementById(&#x27;username&#x27;)
        var email = document.getElementById(&#x27;email&#x27;);
        var date = document.getElementById(&#x27;date-post&#x27;)

        var toPost = {}

        if(this.#profile.username !== username.value){
            toPost.username = username.value;
        }

        if(this.#profile.email !== email.value ){
            toPost.email = email.value;
        }

        if(date.value){

            toPost.date = date.value;
        }
        if(Object.keys(toPost).length !== 0){  //Si el json esta vacio se quieren editar campos
            this.__showLoader()
            var response = await sinte.fetchProfile(&#x27;edit&#x27;,toPost);
            this.__handleResponse(response)
        }else{
            document.getElementById(&#x27;span-no-edit&#x27;).innerText = &#x27;*No has editado ningún campo&#x27;;
            document.getElementById(&#x27;span-no-edit&#x27;).style.display = &#x27;&#x27;;
        }

        

    }
    /**
     * Actualiza los valores de la vista con los del perfil editado
     * 
     * @method editProfile
     */
    editProfile(){
       var username = document.getElementById(&#x27;username&#x27;)
       username.removeAttribute(&#x27;disabled&#x27;) 
       var usernameValue = username.value;
       this.#profile.username = usernameValue;

       var email = document.getElementById(&#x27;email&#x27;);
       email.removeAttribute(&#x27;disabled&#x27;);
       
       var emailValue = email.value;
       this.#profile.email = emailValue;

       document.getElementById(&#x27;date&#x27;).style.display = &#x27;none&#x27;
       document.getElementById(&#x27;date-post&#x27;).style.display = &#x27;&#x27;;

       document.getElementById(&#x27;edit&#x27;).style.display = &#x27;&#x27;;
       document.getElementById(&#x27;cancel&#x27;).style.display = &#x27;&#x27;;
       

    }

    /**
     * Enseña un modal
     * 
     * @method showModal
     */
    showModal(){
        document.getElementById(&quot;backdrop&quot;).style.display = &quot;block&quot;
        document.getElementById(&quot;modalPassword&quot;).style.display = &quot;block&quot;
        document.getElementById(&quot;modalPassword&quot;).className += &quot;show&quot;
    }

    /**
     * Tranforma un string en una fecha para el input del formulario
     * 
     * @method toDate
     * @param {String} string Fecha
     * @returns {Date}
     */
    toDate(string){
        console.log()
        var split  = string.split(&#x27;-&#x27;);
        var year = split[0]
        var month = split[1]
        var day = split[2].split(&#x27;T&#x27;)[0]
        var date = day + &#x27;/&#x27; + month + &#x27;/&#x27; + year
        return date
    }

    /**
     * Método que devuelve el componente Profile para ser renderizado
     * 
     * @method render
     * @return Código html del componente Profile
     * 
     */
    render(){
        return(
            &lt;div style= {{height: &#x27;94%&#x27;}}&gt;
            &lt; Container id=&#x27;background&#x27;fluid style={{backgroundImage: &#x60;url(${portada})&#x60;}}&gt;
            &lt;div id=&#x27;card&#x27;  style={{marginTop: &#x27;5%&#x27;, padding: &#x27;1%&#x27;}}&gt;
                &lt;h1 style={{textAlign: &#x27;center&#x27;}}&gt;Perfil&lt;/h1&gt;
                &lt;br/&gt;
                
             {
                 this.state.profile ? (
                    &lt;div &gt;
                        &lt;ModalPassword&gt;&lt;/ModalPassword&gt;
                        &lt;div id=&#x27;profile&#x27; style={{
                            display: &#x27;flex&#x27;,
                            
                            flexFlow: &#x27;column&#x27;,
                        
                        }}&gt;
                        &lt;div className=&#x27;buttons&#x27;&gt;
                            &lt;button  type=&quot;button&quot; className=&quot;btn btn-light&quot;  onClick={() =&gt; this.editProfile()}&gt;&lt;img style={{width: &#x27;2vw&#x27;}}src={editar}&gt;&lt;/img&gt;&lt;/button&gt;
                            &lt;button  type=&quot;button&quot; onClick={()=&gt; this.showModal()} className=&quot;btn btn-primary&quot; &gt;Cambiar contraseña&lt;/button&gt;

                        &lt;/div&gt;
                        &lt;span  style={{display: &#x27;none&#x27;, color: &#x27;red&#x27;}} id=&#x27;span-no-edit&#x27;&gt;&lt;/span&gt;

                        &lt;label htmlFor=&#x27;username&#x27; style={{marginTop: &#x27;2%&#x27;}}&gt;Nombre de usuario: &lt;/label&gt;
                        &lt;span htmlFor=&#x27;username&#x27; style={{display: &#x27;none&#x27;, color: &#x27;red&#x27;}} id=&#x27;span-username&#x27;&gt;&lt;/span&gt;
                        &lt;input type=&#x27;text&#x27;  id=&#x27;username&#x27; disabled style={{fontSize: &#x27;1.8vh&#x27;, color: &#x27;rgb(38, 38, 38)&#x27;}}  defaultValue={this.state.profile.username} &gt;&lt;/input&gt; 
                        &lt;label htmlFor=&#x27;role&#x27; style={{marginTop: &#x27;2%&#x27;}}&gt;Rol: &lt;/label&gt;
                        &lt;input type=&#x27;text&#x27;  id=&#x27;role&#x27; disabled style={{fontSize: &#x27;1.8vh&#x27;, color: &#x27;rgb(38, 38, 38)&#x27;}} defaultValue={this.state.profile.role} &gt;&lt;/input&gt; 
                        &lt;label htmlFor=&#x27;email&#x27; style={{marginTop: &#x27;2%&#x27;}}&gt;Email: &lt;/label&gt;
                        &lt;span htmlFor=&#x27;email&#x27; style={{display: &#x27;none&#x27;, color: &#x27;red&#x27;}} id=&#x27;span-email&#x27;&gt;&lt;/span&gt;
                        &lt;input type=&#x27;email&#x27;  id=&#x27;email&#x27; disabled style={{fontSize: &#x27;1.8vh&#x27;, color: &#x27;rgb(38, 38, 38)&#x27;}} defaultValue={this.state.profile.email} &gt;&lt;/input&gt;
                        &lt;label htmlFor=&#x27;date&#x27; style={{marginTop: &#x27;2%&#x27;}}&gt;Fecha de nacimiento: &lt;/label&gt;
                        &lt;input type=&#x27;text&#x27;  id=&#x27;date&#x27; disabled style={{fontSize: &#x27;1.8vh&#x27;, color: &#x27;rgb(38, 38, 38)&#x27;}} defaultValue={this.toDate(this.state.profile.date)} &gt;&lt;/input&gt; 
                        &lt;input type=&#x27;date&#x27;  id=&#x27;date-post&#x27;  style={{display: &#x27;none&#x27;, color: &#x27;rgb(38, 38, 38)&#x27;}}  &gt;&lt;/input&gt; 

                        &lt;label htmlFor=&#x27;created&#x27;style={{marginTop: &#x27;2%&#x27;}} &gt;Miembro desde: &lt;/label&gt;
                        &lt;input type=&#x27;text&#x27;  id=&#x27;creted&#x27; disabled style={{fontSize: &#x27;1.8vh&#x27;, color: &#x27;rgb(38, 38, 38)&#x27;}} defaultValue={this.toDate(this.state.profile.created)} &gt;&lt;/input&gt;  
                        &lt;input type=&#x27;date&#x27;  id=&#x27;created-post&#x27;  style={{display: &#x27;none&#x27;, color: &#x27;rgb(38, 38, 38)&#x27;}}  &gt;&lt;/input&gt; 

                        &lt;label htmlFor=&#x27;progress&#x27;style={{marginTop: &#x27;2%&#x27;}} &gt;Espacio disponible: &lt;/label&gt;
                        &lt;p id=&#x27;space-available&#x27; style={{fontSize: &#x27;1.2vh&#x27;}}&gt;&lt;/p&gt;
                        &lt;div className=&quot;progress&quot;&gt;
                            &lt;div className=&quot;progress-bar progress-bar-striped bg-danger&quot; id=&#x27;progress&#x27; role=&quot;progressbar&quot; aria-valuemax=&quot;100&quot;&gt;&lt;/div&gt;
                        &lt;/div&gt;
                                                
                        &lt;button  type=&quot;button&quot; id=&#x27;edit&#x27; className=&quot;btn btn-success&quot; onClick={()=&gt;this.confirmEdit()} style={{display: &#x27;none&#x27; , marginTop: &#x27;2%&#x27;}}&gt;Editar&lt;/button&gt;
                        &lt;button  type=&quot;button&quot; id=&#x27;cancel&#x27; className=&quot;btn btn-danger&quot; onClick={()=&gt;window.location.reload()} style={{display: &#x27;none&#x27;, marginTop: &#x27;2%&#x27;}} &gt;Cancelar&lt;/button&gt;

                        
                        &lt;/div&gt;
                        &lt;div id=&#x27;loader&#x27; style={{display: &#x27;none&#x27;}}&gt;
                                &lt;label style={{marginLeft: &#x27;3%&#x27;}}htmlFor=&quot;recipient-name&quot; className=&quot;col-form-label&quot;&gt;Editando...&lt;/label&gt;
                                &lt;div className=&quot;loader&quot; id=&#x27;loader&#x27; &gt; &lt;/div&gt;

                        &lt;/div&gt;
                        &lt;div id=&#x27;success&#x27; style={{display: &#x27;none&#x27; , margin: &#x27;auto&#x27;, flex: &#x27;auto&#x27;, alignItems: &#x27;center&#x27; , alignContent: &#x27;center&#x27; , textAlign: &#x27;center&#x27;}}&gt;
                            &lt;img alt=&#x27;success-icon&#x27; src={success} style={{width: 60 , marginTop: &#x27;5%&#x27;, marginBottom: &#x27;5%&#x27;}}/&gt;
                            &lt;p id=&#x27;text-success&#x27;&gt;&lt;/p&gt;
                   
                        &lt;/div&gt;
                        &lt;div id=&#x27;failure&#x27; style={{display: &#x27;none&#x27; , margin: &#x27;auto&#x27;, flex: &#x27;auto&#x27;, alignItems: &#x27;center&#x27; , alignContent: &#x27;center&#x27;, textAlign:&#x27;center&#x27; }}&gt;
                            &lt;img alt=&#x27;failure-icon&#x27; src={failure} style={{width: 100 , marginTop: &#x27;5%&#x27;, marginBottom: &#x27;5%&#x27;}}/&gt;
                            &lt;p id=&#x27;text-failure&#x27; &gt;&lt;/p&gt;
                            &lt;button type=&#x27;button&#x27; onClick={()=&gt;{window.location.reload()}} style={{margin: &#x27;auto&#x27;, marginBottom: &#x27;3%&#x27;}} className=&quot;btn btn-primary&quot;&gt;Intentar de nuevo&lt;/button&gt;

                        &lt;/div&gt;
                    &lt;/div&gt;
                    

                 ):(
                     &lt;p&gt;Lo sentimos, hemos tenido un problema al obtener los datos&lt;/p&gt;
                 )
             }
            &lt;/div&gt;
            &lt;/Container&gt;
              &lt;Container style={{height: &#x27;10.5%&#x27; , padding: 0}} fluid&gt;
              &lt;footer  style={{height: &#x27;100%&#x27;, width: &#x27;100%&#x27;}} className=&quot;bg-light text-center text-lg-start&quot;&gt;
                
                 &lt;div className=&quot;text-center p-3&quot; id=&#x27;footer&#x27; &gt;
                     © 2021 Copyright:
                     &lt;a className=&quot;text-dark&quot; href=&quot;https://www.linkedin.com/in/miguel-garc%C3%ADa-tenorio-114352201/&quot;&gt;Miguel García Tenorio&lt;/a&gt;
                 &lt;/div&gt;
                
                 &lt;/footer&gt;
             &lt;/Container&gt;
             &lt;/div&gt;
        )
       
    }
}


export default Profile;
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
